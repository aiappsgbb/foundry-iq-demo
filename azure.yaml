# Azure Developer CLI (azd) configuration
# This file defines the services and infrastructure for the Foundry IQ Demo application

name: foundry-iq-demo
metadata:
  template: foundry-iq-demo@0.1.0

# Infrastructure configuration
infra:
  provider: bicep
  path: infra
  module: main

# Hooks for custom scripts
hooks:
  # Post-provision hook to configure RBAC and set up environment
  postprovision:
    shell: sh
    run: |
      echo "Configuring RBAC permissions..."
      ./infra/hooks/postprovision.sh
    continueOnError: false

  # Post-deploy hook to verify deployment
  postdeploy:
    shell: sh
    run: |
      echo "Deployment completed successfully!"
      echo "Your application is available at: ${SERVICE_WEB_ENDPOINT_URL}"
    continueOnError: true

# Service definitions
# For Azure Static Web Apps with hybrid Next.js, the SWA Oryx builder handles the build.
# We should NOT use prepackage hooks or specify .next/standalone as the dist.
# The SWA deploy action will build and deploy the app automatically.
services:
  web:
    project: ./
    language: js
    host: staticwebapp
