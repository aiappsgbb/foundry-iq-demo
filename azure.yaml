# Azure Developer CLI (azd) configuration
# This file defines the services and infrastructure for the Foundry IQ Demo application

name: foundry-iq-demo
metadata:
  template: foundry-iq-demo@0.1.0

# Infrastructure configuration
infra:
  provider: bicep
  path: infra
  module: main

# Hooks for custom scripts
hooks:
  # Post-provision hook to configure RBAC and set up environment
  postprovision:
    shell: sh
    run: |
      echo "Configuring RBAC permissions..."
      ./infra/hooks/postprovision.sh
    continueOnError: false

  # Post-deploy hook to verify deployment
  postdeploy:
    shell: sh
    run: |
      echo "Deployment completed successfully!"
      echo "Your application is available at: ${SERVICE_WEB_ENDPOINT_URL}"
    continueOnError: true

# Service definitions
# For Azure Static Web Apps with hybrid Next.js deployment via azd:
# - Source code is in the 'web/' subfolder to avoid "source and output at root" error
# - This structure is required by azd for Static Web Apps deployment
# - SWA's Oryx builder handles the Next.js build automatically on Azure
# Reference: https://learn.microsoft.com/azure/developer/azure-developer-cli/azd-schema
services:
  web:
    project: ./web
    language: js
    host: staticwebapp
